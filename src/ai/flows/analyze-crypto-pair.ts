// This is an autogenerated file from Firebase Studio.
'use server';

/**
 * @fileOverview Analyzes a cryptocurrency pair using technical indicators and Gemini AI for trend predictions and recommendations.
 *
 * - analyzeCryptoPair - A function that initiates the cryptocurrency pair analysis.
 * - AnalyzeCryptoPairInput - The input type for the analyzeCryptoPair function.
 * - AnalyzeCryptoPairOutput - The return type for the analyzeCryptoPair function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const AnalyzeCryptoPairInputSchema = z.object({
  pair: z.string().describe('The cryptocurrency pair to analyze (e.g., ETH/USDT).'),
  timeframe: z.string().describe('The timeframe for the analysis (e.g., 15m, 1h, 4h, 1d).'),
  price: z.number().describe('Current price of the crypto pair'),
  rsi: z.number().describe('Relative Strength Index value'),
  macd: z.number().describe('Moving Average Convergence Divergence value'),
  ema: z.number().describe('Exponential Moving Average value'),
});
export type AnalyzeCryptoPairInput = z.infer<typeof AnalyzeCryptoPairInputSchema>;

const AnalyzeCryptoPairOutputSchema = z.object({
  marketOverview: z.string().describe('Overall market assessment.'),
  indicatorExplanations: z.string().describe('Explanations of each technical indicator.'),
  buySellSignal: z.string().describe('Buy or sell signal based on the analysis.'),
  entrySuggestion: z.string().describe('Suggested entry point.'),
  stopLossSuggestion: z.string().describe('Suggested stop-loss level.'),
  takeProfitSuggestion: z.string().describe('Suggested take-profit level.'),
});
export type AnalyzeCryptoPairOutput = z.infer<typeof AnalyzeCryptoPairOutputSchema>;

export async function analyzeCryptoPair(input: AnalyzeCryptoPairInput): Promise<AnalyzeCryptoPairOutput> {
  return analyzeCryptoPairFlow(input);
}

const analyzeCryptoPairPrompt = ai.definePrompt({
  name: 'analyzeCryptoPairPrompt',
  input: {schema: AnalyzeCryptoPairInputSchema},
  output: {schema: AnalyzeCryptoPairOutputSchema},
  prompt: `Analyze the cryptocurrency pair {{{pair}}} with a timeframe of {{{timeframe}}}.\n\nHere are the technical indicators:\n- Price: {{{price}}}\n- RSI: {{{rsi}}}\n- MACD: {{{macd}}}\n- EMA: {{{ema}}}}\n\nProvide the following analysis in Vietnamese:\n- Overall market assessment\n- Explanations of each technical indicator\n- Buy or sell signal\n- Suggested entry point\n- Suggested stop-loss level\n- Suggested take-profit level\n\nMake sure that those indicators align with current price action.\n`,
});

const analyzeCryptoPairFlow = ai.defineFlow(
  {
    name: 'analyzeCryptoPairFlow',
    inputSchema: AnalyzeCryptoPairInputSchema,
    outputSchema: AnalyzeCryptoPairOutputSchema,
  },
  async input => {
    const {output} = await analyzeCryptoPairPrompt(input);
    return output!;
  }
);
