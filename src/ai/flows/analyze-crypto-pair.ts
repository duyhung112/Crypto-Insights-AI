// This is an autogenerated file from Firebase Studio.
'use server';

/**
 * @fileOverview Analyzes a cryptocurrency pair using technical indicators and Gemini AI for trend predictions and recommendations.
 *
 * - analyzeCryptoPair - A function that initiates the cryptocurrency pair analysis.
 * - AnalyzeCryptoPairInput - The input type for the analyzeCryptoPair function.
 * - AnalyzeCryptoPairOutput - The return type for the analyzeCryptoPair function.
 */

import {ai} from '@/ai/genkit';
import { AnalyzeCryptoPairInputSchema, type AnalyzeCryptoPairInput, AnalyzeCryptoPairOutputSchema, type AnalyzeCryptoPairOutput } from '@/lib/types';


export async function analyzeCryptoPair(input: AnalyzeCryptoPairInput): Promise<AnalyzeCryptoPairOutput> {
  return analyzeCryptoPairFlow(input);
}

const analyzeCryptoPairPrompt = ai.definePrompt({
  name: 'analyzeCryptoPairPrompt',
  input: {schema: AnalyzeCryptoPairInputSchema},
  output: {schema: AnalyzeCryptoPairOutputSchema},
  prompt: `B·∫°n l√† m·ªôt chuy√™n gia ph√¢n t√≠ch k·ªπ thu·∫≠t th·ªã tr∆∞·ªùng ti·ªÅn m√£ h√≥a. D·ª±a v√†o d·ªØ li·ªáu ƒë∆∞·ª£c cung c·∫•p cho c·∫∑p {{{pair}}} tr√™n khung th·ªùi gian {{{timeframe}}}, h√£y ph√¢n t√≠ch chi ti·∫øt.

**D·ªØ li·ªáu ƒë·∫ßu v√†o:**
- Gi√° hi·ªán t·∫°i: {{{price}}}
- Gi√° cao nh·∫•t (High): {{{high}}}
- Gi√° th·∫•p nh·∫•t (Low): {{{low}}}
- **RSI (14):** {{{rsi}}}
- **MACD (12, 26, 9):**
    - ƒê∆∞·ªùng MACD: {{{macd.line}}}
    - ƒê∆∞·ªùng Signal: {{{macd.signal}}}
- **EMA:**
    - EMA 9: {{{ema.ema9}}}
    - EMA 21: {{{ema.ema21}}}

**Th·ª±c hi·ªán ph√¢n t√≠ch theo c√°c b∆∞·ªõc sau:**

1.  **ƒê√°nh gi√° t·ªïng quan xu h∆∞·ªõng:**
    - Xu h∆∞·ªõng d·ª±a tr√™n v·ªã tr√≠ c·ªßa gi√° so v·ªõi EMA 9 v√† EMA 21.
    - Xu h∆∞·ªõng d·ª±a tr√™n giao c·∫Øt c·ªßa hai ƒë∆∞·ªùng EMA.
    - Xu h∆∞·ªõng d·ª±a tr√™n MACD (v·ªã tr√≠ so v·ªõi m·ª©c 0, giao c·∫Øt gi·ªØa ƒë∆∞·ªùng MACD v√† ƒë∆∞·ªùng signal).
    - S·ª©c m·∫°nh c·ªßa xu h∆∞·ªõng d·ª±a tr√™n RSI.
    - K·∫øt h·ª£p t·∫•t c·∫£ ƒë·ªÉ ƒë∆∞a ra nh·∫≠n ƒë·ªãnh chung (TƒÉng gi√°, Gi·∫£m gi√°, ƒêi ngang).

2.  **Gi·∫£i th√≠ch √Ω nghƒ©a t·ª´ng ch·ªâ b√°o:**
    - üìà **EMA:** Gi√° ƒëang n·∫±m tr√™n hay d∆∞·ªõi c√°c ƒë∆∞·ªùng EMA? C√≥ giao c·∫Øt v√†ng (EMA ng·∫Øn c·∫Øt l√™n EMA d√†i) hay giao c·∫Øt t·ª≠ th·∫ßn (EMA ng·∫Øn c·∫Øt xu·ªëng EMA d√†i) kh√¥ng?
    - üìä **MACD:** Histogram d∆∞∆°ng hay √¢m? ƒê∆∞·ªùng MACD ƒëang c·∫Øt l√™n hay c·∫Øt xu·ªëng ƒë∆∞·ªùng signal? T√≠n hi·ªáu n√†y m·∫°nh hay y·∫øu?
    - üìâ **RSI:** Ch·ªâ s·ªë RSI ƒëang ·ªü v√πng n√†o (qu√° mua > 70, qu√° b√°n < 30, hay trung t√≠nh)? N√≥ ƒëang c√≥ xu h∆∞·ªõng tƒÉng hay gi·∫£m?

3.  **K·∫øt lu·∫≠n v√† T√≠n hi·ªáu Giao d·ªãch:**
    - D·ª±a v√†o ph√¢n t√≠ch t·ªïng h·ª£p, ƒë∆∞a ra k·∫øt lu·∫≠n cu·ªëi c√πng: **MUA (BUY)**, **B√ÅN (SELL)**, ho·∫∑c **GI·ªÆ (HOLD)**.

4.  **ƒê·ªÅ xu·∫•t K·∫ø ho·∫°ch Giao d·ªãch:**
    - **Gi√° v√†o l·ªánh (Entry):** ƒê·ªÅ xu·∫•t m·ªôt v√πng gi√° h·ª£p l√Ω ƒë·ªÉ v√†o l·ªánh.
    - **D·ª´ng l·ªó (Stop-loss):** ƒê·ªÅ xu·∫•t m·ª©c gi√° c·∫Øt l·ªó ƒë·ªÉ b·∫£o v·ªá v·ªën, th∆∞·ªùng l√† d∆∞·ªõi m·ªôt v√πng h·ªó tr·ª£ g·∫ßn nh·∫•t (cho l·ªánh Mua) ho·∫∑c tr√™n m·ªôt v√πng kh√°ng c·ª± g·∫ßn nh·∫•t (cho l·ªánh B√°n).
    - **Ch·ªët l·ªùi (Take-profit):** ƒê·ªÅ xu·∫•t c√°c m·ª©c gi√° ch·ªët l·ªùi ti·ªÅm nƒÉng, th∆∞·ªùng l√† c√°c v√πng kh√°ng c·ª± (cho l·ªánh Mua) ho·∫∑c h·ªó tr·ª£ (cho l·ªánh B√°n) ti·∫øp theo.

5.  **Qu·∫£n l√Ω r·ªßi ro:**
    - ƒê∆∞a ra m·ªôt l·ªùi khuy√™n ng·∫Øn g·ªçn, s√∫c t√≠ch v·ªÅ qu·∫£n l√Ω r·ªßi ro cho giao d·ªãch n√†y.

**Y√™u c·∫ßu:** Tr·∫£ v·ªÅ k·∫øt qu·∫£ b·∫±ng ti·∫øng Vi·ªát, tr√¨nh b√†y r√µ r√†ng, d·ªÖ hi·ªÉu. S·ª≠ d·ª•ng bullet points ho·∫∑c emoji ƒë·ªÉ l√†m n·ªïi b·∫≠t c√°c √Ω ch√≠nh.`,
});

const analyzeCryptoPairFlow = ai.defineFlow(
  {
    name: 'analyzeCryptoPairFlow',
    inputSchema: AnalyzeCryptoPairInputSchema,
    outputSchema: AnalyzeCryptoPairOutputSchema,
  },
  async input => {
    const {output} = await analyzeCryptoPairPrompt(input);
    return output!;
  }
);
